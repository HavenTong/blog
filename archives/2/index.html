<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="generator" content="Hexo 4.2.1"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Haven Tong&#039;s Memory Palace</title><meta description="a student from ECNU"><meta property="og:type" content="blog"><meta property="og:title" content="Haven Tong&#039;s Memory Palace"><meta property="og:url" content="http://yoursite.com/"><meta property="og:site_name" content="Haven Tong&#039;s Memory Palace"><meta property="og:description" content="a student from ECNU"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://yoursite.com/img/og_image.png"><meta property="article:author" content="Hanwen Tong"><meta property="article:tag" content="童翰文"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://github.com/HavenTong"},"headline":"HanwenTong's Memory Palace","image":["https://github.com/img/og_image.png"],"author":{"@type":"Person","name":"Hanwen Tong"},"description":"a student from ECNU"}</script><link rel="icon" href="/img/tom_avatar.png"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/monokai-sublime.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><!--!--><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/">HavenTong&#039;s Memory Palace</a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-12-06T04:02:11.000Z" title="2019-12-06T04:02:11.000Z">2019-12-06</time><span class="level-item">1 分钟 读完 (大约 138 个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2019/12/06/redis%E5%9F%BA%E6%9C%AC%E9%85%8D%E7%BD%AE%E5%8F%8A%E5%BC%80%E5%85%B3/">redis基本配置及开关</a></h1><div class="content"><h1><span id="redis基本配置及开关">redis基本配置及开关</span></h1>
<h4><span id="配置redis服务端">配置redis服务端</span></h4>
<ul>
<li>
<p>允许远程访问</p>
<p>注释掉 <code>bind 127.0.0.1</code></p>
</li>
<li>
<p>以守护进程运行</p>
<p>将<code>daemonize no</code> 改为 <code>daemonize yes</code></p>
</li>
<li>
<p><code>Java</code> 连接redis必须设置密码：</p>
<p><code>requirepass &lt;password&gt;</code></p>
</li>
</ul>
<h5><span id="查看redis是否在运行">查看redis是否在运行</span></h5>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps -ef | grep -i redis</span><br></pre></td></tr></table></figure>
<h5><span id="远程连接redis">远程连接redis</span></h5>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -h &lt;ip&gt; -p &lt;port&gt; -a &lt;password&gt;</span><br></pre></td></tr></table></figure>
<h5><span id="redis关闭">redis关闭</span></h5>
<ul>
<li>
<p>断电(非正常关闭，容易数据丢失)</p>
<p>查询PID:</p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ps -ef | grep -i redis</span><br><span class="line"><span class="comment"># Then</span></span><br><span class="line"><span class="built_in">kill</span> -9 &lt;PID&gt;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><strong>通过客户端关闭(正常关闭，数据保存)</strong></p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SHUTDOWN</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h5><span id="redis加载配置文件开启">redis加载配置文件开启</span></h5>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-server /usr/<span class="built_in">local</span>/redis/redis.conf</span><br></pre></td></tr></table></figure>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-12-06T03:59:33.000Z" title="2019-12-06T03:59:33.000Z">2019-12-06</time><span class="level-item">4 分钟 读完 (大约 664 个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2019/12/06/redis-conf/">redis.conf</a></h1><div class="content"><h1><span id="redisconf">redis.conf</span></h1>
<h5><span id="绑定的主机地址">绑定的主机地址</span></h5>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">bind</span> 127.0.0.1</span><br></pre></td></tr></table></figure>
<p>如果需要远程访问，则需要注释掉</p>
<h5><span id="守护进程">守护进程</span></h5>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">daemonize no</span><br></pre></td></tr></table></figure>
<p>Redis默认以非守护进程运行，如果想要改为守护进程，则设置为<code>yes</code></p>
<h5><span id="pidfile">pidfile</span></h5>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pidfile /var/run/redis_6379.pid</span><br></pre></td></tr></table></figure>
<p>设置当Redis以守护进程运行时，它的pid写入的文件</p>
<h5><span id="端口">端口</span></h5>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">port 6379</span><br></pre></td></tr></table></figure>
<p>指定Redis的端口</p>
<h5><span id="日志记录级别">日志记录级别</span></h5>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">loglevel verbose</span><br></pre></td></tr></table></figure>
<p>Redis总共支持四个级别：debug, verbose, notice, warning, 默认为verbose</p>
<h5><span id="设置数据库个数">设置数据库个数</span></h5>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">databases 16</span><br></pre></td></tr></table></figure>
<h5><span id="指定在多长时间内有多少次更新操作就将数据同步到数据文件可以多个条件配合">指定在多长时间内，有多少次更新操作，就将数据同步到数据文件，可以多个条件配合</span></h5>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">save &lt;seconds&gt; &lt;changes&gt;</span><br></pre></td></tr></table></figure>
<p>默认配置文件提供三种操作</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">save 900 1</span><br><span class="line">save 300 10</span><br><span class="line">save 60 10000</span><br></pre></td></tr></table></figure>
<p>满足一个就持久化</p>
<h5><span id="指定本地数据库文件名默认为dumprdb">指定本地数据库文件名，默认为dump.rdb</span></h5>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dbfilename dump.rdb</span><br></pre></td></tr></table></figure>
<h5><span id="指定本地数据库存放目录">指定本地数据库存放目录</span></h5>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dir ./</span><br></pre></td></tr></table></figure>
<p>默认当前目录</p>
<h5><span id="主从服务">主从服务</span></h5>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">slaveof &lt;masterip&gt; &lt;masterport&gt;</span><br></pre></td></tr></table></figure>
<p>设置当本机为slave服务时，设置master服务的IP地址及端口，在Redis启动时，它会自动从master进行数据同步</p>
<h5><span id="master服务密码保护">master服务密码保护</span></h5>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">masterauth &lt;master-password&gt;</span><br></pre></td></tr></table></figure>
<p>当master服务设置了密码保护时，slave服务连接master服务的密码</p>
<h5><span id="设置redis连接密码">设置redis连接密码</span></h5>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">requirepass foobared</span><br></pre></td></tr></table></figure>
<p>如果配置了连接密码，客户端在连接Redis时需要通过 <code>AUTH &lt;password&gt;</code>命令提供密码，默认关闭</p>
<p><strong><code>Java</code>连接redis必须设置密码</strong></p>
<h5><span id="设置最大客户端连接数默认无限制">设置最大客户端连接数，默认无限制</span></h5>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">maxclients 10000</span><br></pre></td></tr></table></figure>
<h5><span id="指定redis最大内存限制">指定redis最大内存限制</span></h5>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">maxmemory &lt;bytes&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>
<p>建议根据服务器实际情况设置</p>
</li>
<li>
<p>建议不要超过1G</p>
</li>
</ul>
<h5><span id="对于redis中的内存管理有两种方案">对于redis中的内存管理有两种方案：</span></h5>
<ul>
<li>
<p>为数据设置超时事件</p>
</li>
<li>
<p>采用LRU算法将不用的数据删除</p>
<ul>
<li><code>volatile-lru</code>: 设定超时时间的数据中，删除最不常使用的元素</li>
<li><code>allkeys-lru</code>: 查询所有key中最近最不常使用的数据进行删除，<strong>应用最广泛</strong></li>
<li><code>volatile-random</code>: 在已经设定了超时的数据中随机删除</li>
<li><code>allkeys-random</code>: 查询所有的key之后随机删除</li>
<li><code>volatile-ttl</code>: 查询全部设定超时时间的数据，之后排序，将马上快要过期的数据进行删除操作</li>
<li><code>noevication</code>: 不进行删除操作，内存溢出就报错返回</li>
</ul>
</li>
</ul>
<h4><span id="配置redis服务端">配置redis服务端</span></h4>
<ul>
<li>
<p>允许远程访问</p>
<p>注释掉 <code>bind 127.0.0.1</code></p>
</li>
<li>
<p>以守护进程运行</p>
<p>将<code>daemonize no</code> 改为 <code>daemonize yes</code></p>
</li>
<li>
<p><code>Java</code> 连接redis必须设置密码：</p>
<p><code>requirepass &lt;password&gt;</code></p>
</li>
</ul>
<h5><span id="查看redis是否在运行">查看redis是否在运行</span></h5>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps -ef | grep -i redis</span><br></pre></td></tr></table></figure>
<h5><span id="远程连接redis">远程连接redis</span></h5>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -h &lt;ip&gt; -p &lt;port&gt; -a &lt;password&gt;</span><br></pre></td></tr></table></figure>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-11-19T11:49:22.000Z" title="2019-11-19T11:49:22.000Z">2019-11-19</time><span class="level-item">14 分钟 读完 (大约 2097 个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2019/11/19/Serializable%E6%8E%A5%E5%8F%A3/">Serializable接口</a></h1><div class="content"><h1><span id="serializable接口">Serializable接口</span></h1>
<h3><span id="serializable接口概述"><strong>Serializable接口概述</strong></span></h3>
<p><code>Serializable</code>是<code>java.io</code>包中定义的、用于实现Java类的序列化操作而提供的一个语义级别的接口。<code>Serializable</code>序列化接口没有任何方法或者字段，只是用于标识可序列化的语义。实现了<code>Serializable</code>接口的类可以被<code>ObjectOutputStream</code>转换为字节流，同时也可以通过<code>ObjectInputStream</code>再将其解析为对象。例如，我们可以将序列化对象写入文件后，再次从文件中读取它并反序列化成对象，也就是说，可以使用表示对象及其数据的类型信息和字节在内存中重新创建对象。</p>
<p>而这一点对于面向对象的编程语言来说是非常重要的，因为无论什么编程语言，其底层涉及IO操作的部分还是由操作系统其帮其完成的，而底层IO操作都是以字节流的方式进行的，所以写操作都涉及将编程语言数据类型转换为字节流，而读操作则又涉及将字节流转化为编程语言类型的特定数据类型。而Java作为一门面向对象的编程语言，对象作为其主要数据的类型载体，为了完成对象数据的读写操作，也就需要一种方式来让JVM知道在进行IO操作时如何将对象数据转换为字节流，以及如何将字节流数据转换为特定的对象，而<code>Serializable</code>接口就承担了这样一个角色。</p>
<p>下面我们可以通过例子来实现将序列化的对象存储到文件，然后再将其从文件中反序列化为对象，代码示例如下：</p>
<p>先定义一个序列化对象User：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123; </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>; </span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> String userId; </span><br><span class="line">    <span class="keyword">private</span> String userName; </span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">(String userId, String userName)</span> </span>&#123; </span><br><span class="line">        <span class="keyword">this</span>.userId = userId; </span><br><span class="line">        <span class="keyword">this</span>.userName = userName; </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后我们编写测试类，来对该对象进行读写操作，我们先测试将该对象写入一个文件：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SerializableTest</span> </span>&#123; </span><br><span class="line"> </span><br><span class="line">    <span class="comment">/** </span></span><br><span class="line"><span class="comment">     * 将User对象作为文本写入磁盘 </span></span><br><span class="line"><span class="comment">     */</span> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">writeObj</span><span class="params">()</span> </span>&#123; </span><br><span class="line">        User user = <span class="keyword">new</span> User(<span class="string">"1001"</span>, <span class="string">"Joe"</span>); </span><br><span class="line">        <span class="keyword">try</span> &#123; </span><br><span class="line">            ObjectOutputStream objectOutputStream = <span class="keyword">new</span> ObjectOutputStream(<span class="keyword">new</span> FileOutputStream(<span class="string">"/Users/guanliyuan/user.txt"</span>)); </span><br><span class="line">            objectOutputStream.writeObject(user); </span><br><span class="line">            objectOutputStream.close(); </span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123; </span><br><span class="line">            e.printStackTrace(); </span><br><span class="line">        &#125; </span><br><span class="line">    &#125; </span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String args[])</span> </span>&#123; </span><br><span class="line">        writeObj(); </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行上述代码，我们就将User对象及其携带的数据写入了文本user.txt中，我们可以看下user.txt中存储的数据此时是个什么格式：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">java.io.NotSerializableException: cn.wudimanong.serializable.User </span><br><span class="line">    at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:<span class="number">1184</span>) </span><br><span class="line">    at java.io.ObjectOutputStream.writeObject(ObjectOutputStream.java:<span class="number">348</span>) </span><br><span class="line">    at cn.wudimanong.serializable.SerializableTest.writeObj(SerializableTest.java:<span class="number">19</span>) </span><br><span class="line">    at cn.wudimanong.serializable.SerializableTest.main(SerializableTest.java:<span class="number">27</span>)</span><br></pre></td></tr></table></figure>
<p>我们看到对象数据以二进制文本的方式被持久化到了磁盘文件中。在进行反序列化测试之前，我们可以尝试下将User实现Serializable接口的代码部分去掉，看看此时写操作是否还能成功，结果如下：</p>
<p>结果不出所料，果然是不可以的，抛出了NotSerializableException异常，提示非可序列化异常，也就是说没有实现Serializable接口的对象是无法通过IO操作持久化的。</p>
<p>接下来，我们继续编写测试代码，尝试将之前持久化写入user.txt文件的对象数据再次转化为Java对象，代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SerializableTest</span> </span>&#123; </span><br><span class="line">    <span class="comment">/** </span></span><br><span class="line"><span class="comment">     * 将类从文本中提取并赋值给内存中的类 </span></span><br><span class="line"><span class="comment">     */</span> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">readObj</span><span class="params">()</span> </span>&#123; </span><br><span class="line">        <span class="keyword">try</span> &#123; </span><br><span class="line">            ObjectInputStream objectInputStream = <span class="keyword">new</span> ObjectInputStream(<span class="keyword">new</span> FileInputStream(<span class="string">"/Users/guanliyuan/user.txt"</span>)); </span><br><span class="line">            <span class="keyword">try</span> &#123; </span><br><span class="line">                Object object = objectInputStream.readObject(); </span><br><span class="line">                User user = (User) object; </span><br><span class="line">                System.out.println(user); </span><br><span class="line">            &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123; </span><br><span class="line">                e.printStackTrace(); </span><br><span class="line">            &#125; </span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123; </span><br><span class="line">            e.printStackTrace(); </span><br><span class="line">        &#125; </span><br><span class="line">    &#125; </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String args[])</span> </span>&#123; </span><br><span class="line">        readObj(); </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>通过反序列化操作，可以再次将持久化的对象字节流数据通过IO转化为Java对象，结果如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cn.wudimanong.serializable.User@6f496d9f</span><br></pre></td></tr></table></figure>
<p>此时，如果我们再次尝试将User实现Serializable接口的代码部分去掉，发现也无法再文本转换为序列化对象，报错信息为：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ava.io.InvalidClassException: cn.wudimanong.serializable.User; <span class="class"><span class="keyword">class</span> <span class="title">invalid</span> <span class="title">for</span> <span class="title">deserialization</span> </span></span><br><span class="line">    at java.io.ObjectStreamClass$ExceptionInfo.newInvalidClassException(ObjectStreamClass.java:157) </span><br><span class="line">    at java.io.ObjectStreamClass.checkDeserialize(ObjectStreamClass.java:<span class="number">862</span>) </span><br><span class="line">    at java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:<span class="number">2038</span>) </span><br><span class="line">    at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:<span class="number">1568</span>) </span><br><span class="line">    at java.io.ObjectInputStream.readObject(ObjectInputStream.java:<span class="number">428</span>) </span><br><span class="line">    at cn.wudimanong.serializable.SerializableTest.readObj(SerializableTest.java:<span class="number">31</span>) </span><br><span class="line">    at cn.wudimanong.serializable.SerializableTest.main(SerializableTest.java:<span class="number">44</span>)</span><br></pre></td></tr></table></figure>
<p>提示非法类型转换异常，说明在Java中如何要实现对象的IO读写操作，都必须实现Serializable接口，否则代码就会报错!</p>
<h3><span id="序列化amp反序列化"><strong>序列化&amp;反序列化</strong></span></h3>
<p>通过上面的阐述和示例，相信大家对<code>Serializable</code>接口的作用是有了比较具体的体会了，接下来我们上层到理论层面，看下到底什么是序列化/反序列化。序列化是指把对象转换为字节序列的过程，我们称之为对象的序列化，就是把内存中的这些对象变成一连串的字节(bytes)描述的过程。</p>
<p>而反序列化则相反，就是把持久化的字节文件数据恢复为对象的过程。那么什么情况下需要序列化呢?</p>
<p>大概有这样两类比较常见的场景：</p>
<ul>
<li>需要把内存中的对象状态数据保存到一个文件或者数据库中的时候，这个场景是比较常见的，例如我们利用mybatis框架编写持久层insert对象数据到数据库中时</li>
<li>网络通信时需要用套接字在网络中传送对象时，如我们使用RPC协议进行网络通信时</li>
</ul>
<h3><span id="关于serialversionuid"><strong>关于serialVersionUID</strong></span></h3>
<p>对于JVM来说，要进行持久化的类必须要有一个标记，只有持有这个标记JVM才允许类创建的对象可以通过其IO系统转换为字节数据，从而实现持久化，而这个标记就是<code>Serializable</code>接口。而在反序列化的过程中则需要使用<code>serialVersionUID</code>来确定由那个类来加载这个对象，所以我们在实现<code>Serializable</code>接口的时候，一般还会要去尽量显示地定义<code>serialVersionUID</code>，如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br></pre></td></tr></table></figure>
<p>在反序列化的过程中，如果接收方为对象加载了一个类，如果该对象的<code>serialVersionUID</code>与对应持久化时的类不同，那么反序列化的过程中将会导致<code>InvalidClassException</code>异常。例如，在之前反序列化的例子中，我们故意将<code>User</code>类的<code>serialVersionUID</code>改为<code>2L</code>，如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">2L</span>;</span><br></pre></td></tr></table></figure>
<p>那么此时，在反序例化时就会导致异常，如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">java.io.InvalidClassException: cn.wudimanong.serializable.User; local class incompatible: stream classdesc serialVersionUID = 1, local class serialVersionUID = 2 </span><br><span class="line">    at java.io.ObjectStreamClass.initNonProxy(ObjectStreamClass.java:<span class="number">687</span>) </span><br><span class="line">    at java.io.ObjectInputStream.readNonProxyDesc(ObjectInputStream.java:<span class="number">1880</span>) </span><br><span class="line">    at java.io.ObjectInputStream.readClassDesc(ObjectInputStream.java:<span class="number">1746</span>) </span><br><span class="line">    at java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:<span class="number">2037</span>) </span><br><span class="line">    at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:<span class="number">1568</span>) </span><br><span class="line">    at java.io.ObjectInputStream.readObject(ObjectInputStream.java:<span class="number">428</span>) </span><br><span class="line">    at cn.wudimanong.serializable.SerializableTest.readObj(SerializableTest.java:<span class="number">31</span>) </span><br><span class="line">    at cn.wudimanong.serializable.SerializableTest.main(SerializableTest.java:<span class="number">44</span>)</span><br></pre></td></tr></table></figure>
<p>如果我们在序列化中没有显示地声明<code>serialVersionUID</code>，则序列化运行时将会根据该类的各个方面计算该类默认的<code>serialVersionUID</code>值。但是，Java官方强烈建议所有要序列化的类都显示地声明<code>serialVersionUID</code>字段，因为如果高度依赖于JVM默认生成<code>serialVersionUID</code>，可能会导致其与编译器的实现细节耦合，这样可能会导致在反序列化的过程中发生意外的<code>InvalidClassException</code>异常。因此，为了保证跨不同Java编译器实现的<code>serialVersionUID</code>值的一致，实现<code>Serializable</code>接口的必须显示地声明<code>serialVersionUID</code>字段。</p>
<p>此外<code>serialVersionUID</code>字段地声明要尽可能使用<code>private</code>关键字修饰，这是因为该字段的声明只适用于声明的类，该字段作为成员变量被子类继承是没有用处的!有个特殊的地方需要注意的是，数组类是不能显示地声明<code>serialVersionUID</code>的，因为它们始终具有默认计算的值，不过数组类反序列化过程中也是放弃了匹配<code>serialVersionUID</code>值的要求。</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-11-18T07:42:08.000Z" title="2019-11-18T07:42:08.000Z">2019-11-18</time><span class="level-item">8 分钟 读完 (大约 1228 个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2019/11/18/Spring-Boot-CORS/">Spring Boot-CORS</a></h1><div class="content"><h1><span id="spring-boot-cors">Spring Boot-CORS</span></h1>
<h3><span id="什么是跨域">什么是跨域？</span></h3>
<p>定义：浏览器从一个域名的网页取请求另一个域名下的东西。通俗点说，浏览器直接从A域访问B域中的资源是不被允许的，如果想要访问，就需要进行一步操作，这操作就叫“跨域”。例如，你从百度的页面，点击一个按钮，请求了新浪的一个接口，这就进行了跨域。不单单只有域名不同就是跨域，域名、端口、协议其一不同就是不同的域，请求资源需要跨域。</p>
<h3><span id="为什么要跨域">为什么要跨域？</span></h3>
<p>为什么需要跨域，而不直接访问其他域下的资源呢？这是浏览器的限制，专业点说叫浏览器同源策略限制。主要是为了安全考虑。现在的安全框架，一般请求的时候header中不是都存个token嘛，你要是用这个token去正常访问A域下的东西是没问题的，然后又去访问了B域，结果阴差阳错的还带着这个token，那么B域，或者说B网站是不是就可以拿着你的token去A域下做点什么呢，这就相当危险了。所以浏览器加上了所谓的浏览器同源策略限制。但是为了我们真的需要从A域下访问B的资源（正常访问），就需要用到跨域，跨越这个限制了。</p>
<h3><span id="springboot解决跨域问题">SpringBoot解决跨域问题</span></h3>
<blockquote>
<p>SpringBoot可以基于Cors解决跨域问题，Cors是一种机制，告诉我们的后台，哪边（origin ）来的请求可以访问服务器的数据。</p>
</blockquote>
<h3><span id="全局配置">全局配置</span></h3>
<p>配置实例如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CorsConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> WebMvcConfigurer <span class="title">corsConfigurer</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> WebMvcConfigurer()&#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addCorsMappings</span><span class="params">(CorsRegistry registry)</span></span>&#123;</span><br><span class="line">                registry.addMapping(<span class="string">"/**"</span>)</span><br><span class="line">                        .allowedOrigins(<span class="string">"*"</span>)</span><br><span class="line">                        .allowedMethods(<span class="string">"POST"</span>, <span class="string">"GET"</span>, <span class="string">"PUT"</span>, <span class="string">"OPTIONS"</span>, <span class="string">"DELETE"</span>)</span><br><span class="line">                        .allowCredentials(<span class="keyword">true</span>)</span><br><span class="line">                        .maxAge(<span class="number">3600</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>首先实现了<code>WebMvcConfigurer</code>接口，<code>WebMvcConfigurer</code>这个接口十分强大，里面还有很多可用的方法，在<code>SpringBoot2.0</code>里面可以解决<code>WebMvcConfigurerAdapter</code>曾经的部分任务。其中一个方法就是<code>addCorsMappings()</code>，是专门为开发人员解决跨域而诞生的接口。其中构造参数为<code>CorsRegistry</code>。</p>
<h3><span id="corsregistry的源码">CorsRegistry的源码</span></h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CorsRegistry</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">final</span> List&lt;CorsRegistration&gt; registrations = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> CorsRegistration <span class="title">addMapping</span><span class="params">(String pathPattern)</span> </span>&#123;</span><br><span class="line">      CorsRegistration registration = <span class="keyword">new</span> CorsRegistration(pathPattern);</span><br><span class="line">      <span class="keyword">this</span>.registrations.add(registration);</span><br><span class="line">      <span class="keyword">return</span> registration;</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="function"><span class="keyword">protected</span> Map&lt;String, CorsConfiguration&gt; <span class="title">getCorsConfigurations</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      Map&lt;String, CorsConfiguration&gt; configs = <span class="keyword">new</span> LinkedHashMap&lt;&gt;(<span class="keyword">this</span>.registrations.size());</span><br><span class="line">      <span class="keyword">for</span> (CorsRegistration registration : <span class="keyword">this</span>.registrations) &#123;</span><br><span class="line">         configs.put(registration.getPathPattern(), registration.getCorsConfiguration());</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> configs;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以看出<code>CorsRegistry</code>有个属性<code>registrations</code> ，按道理可以根据不同的项目路径进行定制访问行为，但是我们示例直接将<code>pathPattern</code> 设置为<code>/**</code>，也就是说已覆盖项目所有路径，只需要创建一个CorsRegistration就好。<code>getCorsConfigurations()</code>,这个方法是获取所有<code>CorsConfiguration</code>的Map集合，key值为传入路径<code>pathPattern</code>。<br>
回到示例代码CorsConfig中，<code>registry</code>对象<code>addMapping()</code>增加完传入路径<code>pathPattern</code>之后，return了一个<code>CorsRegistration</code>对象，是进行更多的配置，看一下<code>CorsRegistration</code>的代码，看看我们能配些什么？</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CorsRegistration</span> </span>&#123;</span><br><span class="line">    <span class="comment">//传入的路径</span></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">final</span> String pathPattern;</span><br><span class="line">    <span class="comment">//配置信息实体类</span></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">final</span> CorsConfiguration config;</span><br><span class="line">    <span class="comment">//构造方法</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">CorsRegistration</span><span class="params">(String pathPattern)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.pathPattern = pathPattern;</span><br><span class="line">      <span class="comment">//原生注释看到了一个 @CrossOrigin 这个注解，待会看看是什么</span></span><br><span class="line">      <span class="comment">// Same implicit default values as the @CrossOrigin annotation + allows simple methods</span></span><br><span class="line">      <span class="keyword">this</span>.config = <span class="keyword">new</span> CorsConfiguration().applyPermitDefaultValues();</span><br><span class="line">   &#125;</span><br><span class="line">    <span class="comment">//允许哪些源网站访问，默认所有</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> CorsRegistration <span class="title">allowedOrigins</span><span class="params">(String... origins)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.config.setAllowedOrigins(Arrays.asList(origins));</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">   &#125;</span><br><span class="line">    <span class="comment">//允许何种方式访问，默认简单方式，即：GET，HEAD，POST</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> CorsRegistration <span class="title">allowedMethods</span><span class="params">(String... methods)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.config.setAllowedMethods(Arrays.asList(methods));</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">   &#125;</span><br><span class="line">    <span class="comment">//设置访问header，默认所有</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> CorsRegistration <span class="title">allowedHeaders</span><span class="params">(String... headers)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.config.setAllowedHeaders(Arrays.asList(headers));</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">   &#125;</span><br><span class="line">    <span class="comment">//设置response headers，默认没有（什么都不设置）</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> CorsRegistration <span class="title">exposedHeaders</span><span class="params">(String... headers)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.config.setExposedHeaders(Arrays.asList(headers));</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">   &#125;</span><br><span class="line">    <span class="comment">//是否浏览器应该发送credentials，例如cookies Access-Control-Allow-Credentials</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> CorsRegistration <span class="title">allowCredentials</span><span class="params">(<span class="keyword">boolean</span> allowCredentials)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.config.setAllowCredentials(allowCredentials);</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">   &#125;</span><br><span class="line">    <span class="comment">//设置等待时间，默认1800秒</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> CorsRegistration <span class="title">maxAge</span><span class="params">(<span class="keyword">long</span> maxAge)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.config.setMaxAge(maxAge);</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">protected</span> String <span class="title">getPathPattern</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.pathPattern;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">protected</span> CorsConfiguration <span class="title">getCorsConfiguration</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.config;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3><span id="局部配置">局部配置</span></h3>
<p>在Controller上加入<code>@CrossOrigin</code>注解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target</span>(&#123; ElementType.METHOD, ElementType.TYPE &#125;)</span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> CrossOrigin &#123;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/** <span class="doctag">@deprecated</span> as of Spring 5.0, in favor of &#123;<span class="doctag">@link</span> CorsConfiguration#applyPermitDefaultValues&#125; */</span></span><br><span class="line">   <span class="meta">@Deprecated</span></span><br><span class="line">   String[] DEFAULT_ORIGINS = &#123; <span class="string">"*"</span> &#125;;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/** <span class="doctag">@deprecated</span> as of Spring 5.0, in favor of &#123;<span class="doctag">@link</span> CorsConfiguration#applyPermitDefaultValues&#125; */</span></span><br><span class="line">   <span class="meta">@Deprecated</span></span><br><span class="line">   String[] DEFAULT_ALLOWED_HEADERS = &#123; <span class="string">"*"</span> &#125;;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/** <span class="doctag">@deprecated</span> as of Spring 5.0, in favor of &#123;<span class="doctag">@link</span> CorsConfiguration#applyPermitDefaultValues&#125; */</span></span><br><span class="line">   <span class="meta">@Deprecated</span></span><br><span class="line">   <span class="keyword">boolean</span> DEFAULT_ALLOW_CREDENTIALS = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/** <span class="doctag">@deprecated</span> as of Spring 5.0, in favor of &#123;<span class="doctag">@link</span> CorsConfiguration#applyPermitDefaultValues&#125; */</span></span><br><span class="line">   <span class="meta">@Deprecated</span></span><br><span class="line">   <span class="keyword">long</span> DEFAULT_MAX_AGE = <span class="number">1800</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * Alias for &#123;<span class="doctag">@link</span> #origins&#125;.</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@AliasFor</span>(<span class="string">"origins"</span>)</span><br><span class="line">   String[] value() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@AliasFor</span>(<span class="string">"value"</span>)</span><br><span class="line">   String[] origins() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">   String[] allowedHeaders() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">   String[] exposedHeaders() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">   RequestMethod[] methods() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">   <span class="function">String <span class="title">allowCredentials</span><span class="params">()</span> <span class="keyword">default</span> ""</span>;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">long</span> <span class="title">maxAge</span><span class="params">()</span> <span class="keyword">default</span> -1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个注解可以作用于方法或者类上，实现局部跨域，你会发现除了设置路径（因为没必要了，都定位到局部了）其他的参数与全局类似。</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-11-17T16:29:31.000Z" title="2019-11-17T16:29:31.000Z">2019-11-18</time><span class="level-item">3 分钟 读完 (大约 485 个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2019/11/18/C++-priority-queue/">C++-priority_queue</a></h1><div class="content"><h2><span id="cpriority_queue">C+±priority_queue</span></h2>
<h4><span id="c-stl-priority_queue-用法">C++ STL-priority_queue 用法</span></h4>
<p><code>priority_queue</code>存在于头文件<code>&lt;queue&gt;</code>中，以下代码解释了该容器如何使用</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Node</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> a,b;</span><br><span class="line">    Node()&#123;&#125;</span><br><span class="line">    Node(<span class="keyword">int</span> aa,<span class="keyword">int</span> bb):a(aa),b(bb)&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 二级排序，a相同时按照b升序排序，否则按照a升序排序</span></span><br><span class="line">    <span class="comment">// (a,b): (1,1)&lt;(1,2)&lt;(2,1)&lt;(2,2)</span></span><br><span class="line">    <span class="comment">// 这里重载的大于号和小于号在逻辑上等价</span></span><br><span class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span> &lt; (<span class="keyword">const</span> Node &amp;r) <span class="keyword">const</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(a==r.a)</span><br><span class="line">            <span class="keyword">return</span> b&lt;r.b;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">return</span> a&lt;r.a;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span> &gt; (<span class="keyword">const</span> Node &amp;r) <span class="keyword">const</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(a==r.a)</span><br><span class="line">            <span class="keyword">return</span> b&gt;r.b;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">return</span> a&gt;r.a;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//priority_queue 是基于堆实现的优先队列</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// .size()返回当前优先队列的元素个数</span></span><br><span class="line">    <span class="comment">// empty()为true表示当前队列为空，false表示不空</span></span><br><span class="line">    priority_queue&lt;<span class="keyword">int</span>&gt; tmp_q;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;tmp_q.size()&lt;&lt;<span class="built_in">endl</span>;   <span class="comment">//0</span></span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;tmp_q.empty()&lt;&lt;<span class="built_in">endl</span>;  <span class="comment">//1</span></span><br><span class="line">    tmp_q.push(<span class="number">1</span>);</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;tmp_q.size()&lt;&lt;<span class="built_in">endl</span>;   <span class="comment">//1</span></span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;tmp_q.empty()&lt;&lt;<span class="built_in">endl</span>;  <span class="comment">//0</span></span><br><span class="line">    tmp_q.pop();</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;tmp_q.size()&lt;&lt;<span class="built_in">endl</span>;   <span class="comment">//0</span></span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;tmp_q.empty()&lt;&lt;<span class="built_in">endl</span>;  <span class="comment">//1</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// priority_queue&lt;int&gt; 表示队列中存储的元素是int类型（STL模板类）</span></span><br><span class="line">    <span class="comment">// 默认priority_queue表示队列按照less出队</span></span><br><span class="line">    <span class="comment">// 后出队的元素比先出队的元素要小，出队的元素越来越小，所以是less</span></span><br><span class="line">    <span class="comment">// push 加入元素</span></span><br><span class="line">    <span class="comment">// top 返回队首元素</span></span><br><span class="line">    <span class="comment">// pop 队首元素出队</span></span><br><span class="line">    priority_queue&lt;<span class="keyword">int</span>&gt; q;  </span><br><span class="line">    q.push(<span class="number">5</span>);</span><br><span class="line">    q.push(<span class="number">6</span>);</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;q.top()&lt;&lt;<span class="built_in">endl</span>;        <span class="comment">//6</span></span><br><span class="line">    q.pop();</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;q.top()&lt;&lt;<span class="built_in">endl</span>;        <span class="comment">//5</span></span><br><span class="line">    q.pop();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// greater 表示后出队的元素比先出队的元素要大, 出队的元素越来越大，所以是greater</span></span><br><span class="line">    priority_queue&lt;<span class="keyword">int</span>, <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;, greater&lt;<span class="keyword">int</span>&gt;&gt; q_greater;</span><br><span class="line">    <span class="comment">// &lt;&gt;中第二个参数vector&lt;int&gt;表示优先队列中使用vector&lt;int&gt; 存储元素，可以更换成deque</span></span><br><span class="line">    <span class="comment">// 第二个参数中更换的其他类型应支持.begin(),.end(),.push(),.pop()等操作</span></span><br><span class="line">    <span class="comment">//  绝大多数情况都使用vector&lt;&gt;，极少需要更换</span></span><br><span class="line">    <span class="comment">// 例子：priority_queue&lt;int, deque&lt;int&gt;, greater&lt;int&gt;&gt; q_greater;</span></span><br><span class="line">    q_greater.push(<span class="number">5</span>);</span><br><span class="line">    q_greater.push(<span class="number">6</span>);</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;q_greater.top()&lt;&lt;<span class="built_in">endl</span>;    <span class="comment">//5</span></span><br><span class="line">    q_greater.pop();</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;q_greater.top()&lt;&lt;<span class="built_in">endl</span>;    <span class="comment">//6</span></span><br><span class="line">    q_greater.pop();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 更换为double类型，出队法则是less</span></span><br><span class="line">    priority_queue&lt;<span class="keyword">double</span>, <span class="built_in">vector</span>&lt;<span class="keyword">double</span>&gt;, less&lt;<span class="keyword">double</span>&gt;&gt; q_less;</span><br><span class="line">    q_less.push(<span class="number">5.2</span>);</span><br><span class="line">    q_less.push(<span class="number">6.6</span>);</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;q_less.top()&lt;&lt;<span class="built_in">endl</span>;       <span class="comment">//6.6</span></span><br><span class="line">    q_less.pop();</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;q_less.top()&lt;&lt;<span class="built_in">endl</span>;       <span class="comment">//5.2</span></span><br><span class="line">    q_less.pop();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 自定义类Node的priority_queue 使用greater需要对元素重载大于号</span></span><br><span class="line">    priority_queue&lt;Node, <span class="built_in">vector</span>&lt;Node&gt;, greater&lt;Node&gt;&gt; q_greater_node;</span><br><span class="line">    q_greater_node.push(Node(<span class="number">1</span>,<span class="number">1</span>));</span><br><span class="line">    q_greater_node.push(Node(<span class="number">1</span>,<span class="number">2</span>));</span><br><span class="line">    q_greater_node.push(Node(<span class="number">2</span>,<span class="number">1</span>));</span><br><span class="line">    q_greater_node.push(Node(<span class="number">2</span>,<span class="number">2</span>));</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;q_greater_node.top().a&lt;&lt;<span class="string">" "</span>&lt;&lt;q_greater_node.top().b&lt;&lt;<span class="built_in">endl</span>;    <span class="comment">// 1 1</span></span><br><span class="line">    q_greater_node.pop();</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;q_greater_node.top().a&lt;&lt;<span class="string">" "</span>&lt;&lt;q_greater_node.top().b&lt;&lt;<span class="built_in">endl</span>;    <span class="comment">// 1 2</span></span><br><span class="line">    q_greater_node.pop();</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;q_greater_node.top().a&lt;&lt;<span class="string">" "</span>&lt;&lt;q_greater_node.top().b&lt;&lt;<span class="built_in">endl</span>;    <span class="comment">// 2 1</span></span><br><span class="line">    q_greater_node.pop();</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;q_greater_node.top().a&lt;&lt;<span class="string">" "</span>&lt;&lt;q_greater_node.top().b&lt;&lt;<span class="built_in">endl</span>;    <span class="comment">// 2 2</span></span><br><span class="line">    q_greater_node.pop();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 自定义类Node的priority_queue 使用less需要对元素重载小于号</span></span><br><span class="line">    priority_queue&lt;Node, <span class="built_in">vector</span>&lt;Node&gt;, less&lt;Node&gt;&gt; q_less_node;</span><br><span class="line">    q_less_node.push(Node(<span class="number">1</span>,<span class="number">1</span>));</span><br><span class="line">    q_less_node.push(Node(<span class="number">1</span>,<span class="number">2</span>));</span><br><span class="line">    q_less_node.push(Node(<span class="number">2</span>,<span class="number">1</span>));</span><br><span class="line">    q_less_node.push(Node(<span class="number">2</span>,<span class="number">2</span>));</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;q_less_node.top().a&lt;&lt;<span class="string">" "</span>&lt;&lt;q_less_node.top().b&lt;&lt;<span class="built_in">endl</span>;  <span class="comment">// 2 2 </span></span><br><span class="line">    q_less_node.pop();</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;q_less_node.top().a&lt;&lt;<span class="string">" "</span>&lt;&lt;q_less_node.top().b&lt;&lt;<span class="built_in">endl</span>;  <span class="comment">// 2 1</span></span><br><span class="line">    q_less_node.pop();</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;q_less_node.top().a&lt;&lt;<span class="string">" "</span>&lt;&lt;q_less_node.top().b&lt;&lt;<span class="built_in">endl</span>;  <span class="comment">// 1 2</span></span><br><span class="line">    q_less_node.pop();</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;q_less_node.top().a&lt;&lt;<span class="string">" "</span>&lt;&lt;q_less_node.top().b&lt;&lt;<span class="built_in">endl</span>;  <span class="comment">// 1 1</span></span><br><span class="line">    q_less_node.pop();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-11-07T03:59:00.000Z" title="2019-11-07T03:59:00.000Z">2019-11-07</time><span class="level-item">5 分钟 读完 (大约 753 个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2019/11/07/SpringBoot-Mybatis/">SpringBoot-Mybatis</a></h1><div class="content"><h1><span id="spring-boot-mybatis">Spring Boot-Mybatis</span></h1>
<h2><span id="1-orm框架选型">1. ORM框架选型</span></h2>
<table>
<thead>
<tr>
<th style="text-align:center">对比项</th>
<th style="text-align:center">SPRING DATA JPA</th>
<th style="text-align:center">MYBATIS</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">单表操作方式</td>
<td style="text-align:center">只需继承，代码量较少，非常方便。而且支持方法名用关键字生成SQL</td>
<td style="text-align:center">可以使用代码生成工具，也很方便，但相对JPA单表弱很多。JPA单表操作非常简单</td>
</tr>
<tr>
<td style="text-align:center">多表关联查询</td>
<td style="text-align:center">友好，动态SQL使用不够方便，而且SQL和代码耦合到一起</td>
<td style="text-align:center">非常友好，可以有非常直观的动态SQL</td>
</tr>
<tr>
<td style="text-align:center">自定义SQL</td>
<td style="text-align:center">SQL写在注解里面，写动态SQL有些费劲</td>
<td style="text-align:center">SQL可以写在XML里，独立管理，动态SQL语法也容易书写理解</td>
</tr>
<tr>
<td style="text-align:center">学习成本</td>
<td style="text-align:center">略高</td>
<td style="text-align:center">较低，会写SQL就可以</td>
</tr>
</tbody>
</table>
<p>JPA是规范，Hibernate是实现</p>
<ul>
<li>Spring Data JPA 对开发人员更加友好，单表操作非常方便，多表关联也不麻烦</li>
<li>mybatis各方面都很优秀，使用范围更广</li>
<li>大型项目建议mybatis</li>
</ul>
<h2><span id="2-整合mybatis操作数据库">2. 整合MyBatis操作数据库</span></h2>
<ul>
<li>pom.xml</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>mybatis-config.xml</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE configuration PUBLIC "-//mybatis.org//DTD Config 3.0//EN" "http://mybatis.org/dtd/mybatis-3-config.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--    配置全局属性--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--    使用Jdbc的getGeneratedKeys获取数据库自增主键值   --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"useGeneratedKeys"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--    使用列表签替换列别名        --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"useColumnLabel"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--   开启驼峰命名转换: Table&#123;create_time&#125; -&gt; Entity&#123;createTime&#125;      --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"mapUnderscoreToCamelCase"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>同样的内容也可以写在Spring Boot配置文件application.yml中</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">  datasource:</span></span><br><span class="line"><span class="attr">    username:</span> <span class="string">root</span></span><br><span class="line"><span class="attr">    password:</span> <span class="string">Thwf1858</span></span><br><span class="line"><span class="attr">    url:</span> <span class="attr">jdbc:mysql://localhost:3306/mybatis</span></span><br><span class="line"><span class="attr">    driver-class-name:</span> <span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="attr">logging:</span></span><br><span class="line"><span class="attr">  level:</span></span><br><span class="line">    <span class="string">com.haven.mybatis.mapper:</span> <span class="string">debug</span></span><br><span class="line"><span class="attr">mybatis:</span></span><br><span class="line"><span class="attr">  configuration:</span></span><br><span class="line"><span class="attr">    map-underscore-to-camel-case:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">    use-generated-keys:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">    use-column-label:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>
<ul>
<li>注解书写SQL</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hehe.mapper;</span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMapper</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 方式1：使用注解编写SQL。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Select</span>(<span class="string">"select * from t_user"</span>)</span><br><span class="line">    <span class="function">List&lt;User&gt; <span class="title">list</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 方式2：使用注解指定某个工具类的方法来动态编写SQL.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@SelectProvider</span>(type = UserSqlProvider.class, method = <span class="string">"listByUsername"</span>)</span><br><span class="line">    <span class="function">List&lt;User&gt; <span class="title">listByUsername</span><span class="params">(String username)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 延伸：上述两种方式都可以附加<span class="doctag">@Results</span>注解来指定结果集的映射关系.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * PS：如果符合下划线转驼峰的匹配项可以直接省略不写。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Results</span>(&#123;</span><br><span class="line">            <span class="meta">@Result</span>(property = <span class="string">"userId"</span>, column = <span class="string">"USER_ID"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(property = <span class="string">"username"</span>, column = <span class="string">"USERNAME"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(property = <span class="string">"password"</span>, column = <span class="string">"PASSWORD"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(property = <span class="string">"mobileNum"</span>, column = <span class="string">"PHONE_NUM"</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="meta">@Select</span>(<span class="string">"select * from t_user"</span>)</span><br><span class="line">    <span class="function">List&lt;User&gt; <span class="title">listSample</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 延伸：无论什么方式,如果涉及多个参数,则必须加上<span class="doctag">@Param</span>注解,否则无法使用EL表达式获取参数。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Select</span>(<span class="string">"select * from t_user where username like #&#123;username&#125; and password like #&#123;password&#125;"</span>)</span><br><span class="line">    <span class="function">User <span class="title">get</span><span class="params">(@Param(<span class="string">"username"</span>)</span> String username, @<span class="title">Param</span><span class="params">(<span class="string">"password"</span>)</span> String password)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SelectProvider</span>(type = UserSqlProvider.class, method = <span class="string">"getBadUser"</span>)</span><br><span class="line">    <span class="function">User <span class="title">getBadUser</span><span class="params">(@Param(<span class="string">"username"</span>)</span> String username, @<span class="title">Param</span><span class="params">(<span class="string">"password"</span>)</span> String password)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>
<p>可以传入参数</p>
<ul>
<li>JavaBean</li>
<li>Map</li>
<li>多个参数，需要用<code>@Param</code>注解</li>
</ul>
</li>
<li>
<p><code>@Results</code>注解</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Select</span>(<span class="string">"select t_id, t_age, t_name  "</span></span><br><span class="line">            + <span class="string">"from sys_user             "</span></span><br><span class="line">            + <span class="string">"where t_id = #&#123;id&#125;        "</span>)</span><br><span class="line">    <span class="meta">@Results</span>(id=<span class="string">"userResults"</span>, value=&#123;</span><br><span class="line">            <span class="meta">@Result</span>(property=<span class="string">"id"</span>,   column=<span class="string">"t_id"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(property=<span class="string">"age"</span>,  column=<span class="string">"t_age"</span>),</span><br><span class="line">            <span class="meta">@Result</span>(property=<span class="string">"name"</span>, column=<span class="string">"t_name"</span>),</span><br><span class="line">    &#125;)</span><br><span class="line">　　 <span class="function">User <span class="title">selectUserById</span><span class="params">(@Param(<span class="string">"id"</span>)</span> String id)</span>;</span><br></pre></td></tr></table></figure>
<p><code>@Results</code>可以给出一个id，其他方法根据该id可以通过<code>@ResultMap</code>重复使用：</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Select</span>(<span class="string">"select t_id, t_age, t_name  "</span></span><br><span class="line">           + <span class="string">"from sys_user             "</span></span><br><span class="line">           + <span class="string">"where t_name = #&#123;name&#125;        "</span>)</span><br><span class="line">   <span class="meta">@ResultMap</span>(<span class="string">"userResults"</span>)</span><br><span class="line">    　　 <span class="function">User <span class="title">selectUserByName</span><span class="params">(@Param(<span class="string">"name"</span>)</span> String name)</span>;</span><br></pre></td></tr></table></figure></li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-10-31T08:13:55.000Z" title="2019-10-31T08:13:55.000Z">2019-10-31</time><span class="level-item">10 分钟 读完 (大约 1430 个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2019/10/31/Spring-Boot-JDBC/">Spring Boot-JDBC</a></h1><div class="content"><h1><span id="spring-boot-amp-jdbc">Spring Boot &amp; JDBC</span></h1>
<h2><span id="1-spring-boot整合jdbc操作数据库">1. Spring Boot整合JDBC操作数据库</span></h2>
<h3><span id="jdbc操作数据库流程">JDBC操作数据库流程</span></h3>
<ol>
<li>加载数据库驱动</li>
<li>建立数据库连接</li>
<li>创建数据库操作对象</li>
<li>定义操作的SQL语句</li>
<li>执行数据库操作</li>
<li>获取并操作结果集</li>
<li>关闭对象，回收资源</li>
</ol>
<p><em>不建议使用JDBC</em></p>
<h3><span id="将spring-jdbc整合到spring-boot">将Spring JDBC整合到Spring Boot</span></h3>
<ol>
<li>pom.xml引入依赖</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-jdbc --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.8.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- https://mvnrepository.com/artifact/mysql/mysql-connector-java --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0.16<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ol start="2">
<li>修改application.yml</li>
</ol>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">  datasource:</span></span><br><span class="line"><span class="attr">    url:</span> <span class="attr">jdbc:mysql://localhost:3306/jdbc</span></span><br><span class="line"><span class="attr">    username:</span> <span class="string">root</span></span><br><span class="line"><span class="attr">    password:</span> <span class="string">Thwf1858</span></span><br><span class="line"><span class="attr">    driver-class-name:</span> <span class="string">com.mysql.jdbc.Driver</span></span><br></pre></td></tr></table></figure>
<ol start="3">
<li>DAO层代码</li>
</ol>
<ul>
<li>
<p><code>jdbcTemplate.update</code>适用于insert, update和delete操作</p>
</li>
<li>
<p><code>jdbcTemplate.queryForObject</code>用于查询单条记录并返回结果</p>
</li>
<li>
<p><code>jdbcTemplate.query</code>用于查询结果列表</p>
</li>
<li>
<p><code>BeanPropertyRowMapper</code>可以将数据库字段的值向数据库映射，满足驼峰标识也可以自动映射</p>
<p>e.x. 数据库create_time映射到createTime属性</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.haven.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.BeanProperty;</span><br><span class="line"><span class="keyword">import</span> com.haven.model.Article;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.BeanPropertyRowMapper;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.JdbcTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Repository;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> HavenTong</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019/10/30 10:39 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Repository</span> <span class="comment">// @Repository标注持久层 </span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ArticleJDBCDAO</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> JdbcTemplate jdbcTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 保存文章</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">(Article article)</span></span>&#123;</span><br><span class="line">        jdbcTemplate.update(<span class="string">"INSERT INTO article(author, title, content, create_time) values (?,?,?,?)"</span>,</span><br><span class="line">                article.getAuthor(),</span><br><span class="line">                article.getTitle(),</span><br><span class="line">                article.getContent(),</span><br><span class="line">                article.getCreateTime());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 删除文章</span></span><br><span class="line">  	<span class="comment">// 传参可以用 new Object[]&#123;&#125;传，也可以一个一个设置</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteById</span><span class="params">(<span class="keyword">int</span> id)</span></span>&#123;</span><br><span class="line">        jdbcTemplate.update(<span class="string">"DELETE FROM article WHERE id=?"</span>, <span class="keyword">new</span> Object[]&#123;id&#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 更新文章</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateById</span><span class="params">(Article article)</span></span>&#123;</span><br><span class="line">        jdbcTemplate.update(<span class="string">"UPDATE article SET author=?, title=?, content=?, create_time=? WHERE id=?"</span>,</span><br><span class="line">                article.getAuthor(),</span><br><span class="line">                article.getTitle(),</span><br><span class="line">                article.getContent(),</span><br><span class="line">                article.getCreateTime(),</span><br><span class="line">                article.getId());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据id查找文章</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Article <span class="title">findById</span><span class="params">(<span class="keyword">int</span> id)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (Article)jdbcTemplate.queryForObject(<span class="string">"SELECT * FROM article WHERE id = ?"</span>,</span><br><span class="line">                <span class="keyword">new</span> Object[]&#123;id&#125;,</span><br><span class="line">                <span class="keyword">new</span> BeanPropertyRowMapper(Article.class));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询所有</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Article&gt; <span class="title">findAll</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (List&lt;Article&gt;) jdbcTemplate.query(<span class="string">"SELECT * FROM article"</span>, <span class="keyword">new</span> BeanPropertyRowMapper(Article.class));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2><span id="2-jdbc多数据源">2. JDBC多数据源</span></h2>
<p>(1) application.yml配置两个数据源，第一个叫primary, 第二个叫secondar,也可以自己取名:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line"><span class="attr">  port:</span> <span class="number">8080</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">  jackson:</span></span><br><span class="line"><span class="attr">    date-format:</span> <span class="string">yyyy-MM-dd</span> <span class="attr">HH:mm:ss</span></span><br><span class="line"><span class="attr">    time-zone:</span> <span class="string">GMT+8</span></span><br><span class="line"><span class="attr">  datasource:</span></span><br><span class="line"><span class="attr">    primary:</span></span><br><span class="line"><span class="attr">      jdbc-url:</span> <span class="attr">jdbc:mysql://localhost:3306/jdbc</span></span><br><span class="line"><span class="attr">      username:</span> <span class="string">root</span></span><br><span class="line"><span class="attr">      password:</span> <span class="string">Thwf1858</span></span><br><span class="line"><span class="attr">      driver-class-name:</span> <span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="attr">    secondary:</span></span><br><span class="line"><span class="attr">      jdbc-url:</span> <span class="attr">jdbc:mysql://localhost:3306/test</span></span><br><span class="line"><span class="attr">      username:</span> <span class="string">root</span></span><br><span class="line"><span class="attr">      password:</span> <span class="string">Thwf1858</span></span><br><span class="line"><span class="attr">      driver-class-name:</span> <span class="string">com.mysql.jdbc.Driver</span></span><br></pre></td></tr></table></figure>
<p>(2) 通过Java Config将数据源注入到Spring上下文</p>
<p>primaryJdbcTemplate使用primaryDataSource数据源操作数据库jdbc</p>
<p>secondaryJdbcTemplate使用secondaryDataSource数据源操作数据库test</p>
<p><code>DataSourceConfig.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.haven.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Qualifier;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.jdbc.DataSourceBuilder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Primary;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.JdbcTemplate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.sql.DataSource;</span><br><span class="line"><span class="keyword">import</span> javax.xml.crypto.Data;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> HavenTong</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019/10/31 12:08 上午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DataSourceConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Primary</span></span><br><span class="line">    <span class="meta">@Bean</span>(name = <span class="string">"primaryDataSource"</span>)</span><br><span class="line">    <span class="meta">@Qualifier</span>(<span class="string">"primaryDataSource"</span>)</span><br><span class="line">    <span class="meta">@ConfigurationProperties</span>(prefix = <span class="string">"spring.datasource.primary"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> DataSource <span class="title">primaryDataSource</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> DataSourceBuilder.create().build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span>(name = <span class="string">"secondaryDataSource"</span>)</span><br><span class="line">    <span class="meta">@Qualifier</span>(<span class="string">"secondaryDataSource"</span>)</span><br><span class="line">    <span class="meta">@ConfigurationProperties</span>(prefix = <span class="string">"spring.datasource.secondary"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> DataSource <span class="title">secondaryDataSource</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> DataSourceBuilder.create().build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span>(name = <span class="string">"primaryJdbcTemplate"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> JdbcTemplate <span class="title">primaryJdbcTemplate</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">            @Qualifier(<span class="string">"primaryDataSource"</span>)</span> DataSource dataSource )</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> JdbcTemplate(dataSource);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span>(name = <span class="string">"secondaryJdbcTemplate"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> JdbcTemplate <span class="title">secondaryTemplate</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">            @Qualifier(<span class="string">"secondaryDataSource"</span>)</span> DataSource dataSource)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> JdbcTemplate(dataSource);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>(3) 之后修改dao层代码:</p>
<p><code>ArticleJDBCDAO.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.haven.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.BeanProperty;</span><br><span class="line"><span class="keyword">import</span> com.haven.model.Article;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.BeanPropertyRowMapper;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.JdbcTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Repository;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> HavenTong</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019/10/30 10:39 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ArticleJDBCDAO</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 保存文章</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">(Article article, JdbcTemplate jdbcTemplate)</span></span>&#123;</span><br><span class="line">        jdbcTemplate.update(<span class="string">"INSERT INTO article(author, title, content, create_time) values (?,?,?,?)"</span>,</span><br><span class="line">                article.getAuthor(),</span><br><span class="line">                article.getTitle(),</span><br><span class="line">                article.getContent(),</span><br><span class="line">                article.getCreateTime());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 删除文章</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteById</span><span class="params">(<span class="keyword">int</span> id, JdbcTemplate jdbcTemplate)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        jdbcTemplate.update(<span class="string">"DELETE FROM article WHERE id=?"</span>, <span class="keyword">new</span> Object[]&#123;id&#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 更新文章</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateById</span><span class="params">(Article article, JdbcTemplate jdbcTemplate)</span></span>&#123;</span><br><span class="line">        jdbcTemplate.update(<span class="string">"UPDATE article SET author=?, title=?, content=?, create_time=? WHERE id=?"</span>,</span><br><span class="line">                article.getAuthor(),</span><br><span class="line">                article.getTitle(),</span><br><span class="line">                article.getContent(),</span><br><span class="line">                article.getCreateTime(),</span><br><span class="line">                article.getId());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据id查找文章</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Article <span class="title">findById</span><span class="params">(<span class="keyword">int</span> id, JdbcTemplate jdbcTemplate)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (Article)jdbcTemplate.queryForObject(<span class="string">"SELECT * FROM article WHERE id = ?"</span>,</span><br><span class="line">                <span class="keyword">new</span> Object[]&#123;id&#125;,</span><br><span class="line">                <span class="keyword">new</span> BeanPropertyRowMapper(Article.class));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询所有</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Article&gt; <span class="title">findAll</span><span class="params">(JdbcTemplate jdbcTemplate)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (List&lt;Article&gt;) jdbcTemplate.query(<span class="string">"SELECT * FROM article"</span>, <span class="keyword">new</span> BeanPropertyRowMapper(Article.class));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>(4) 修改service层代码</p>
<p><code>ArticleRestJDBCServiceImpl.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.haven.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.haven.dao.ArticleJDBCDAO;</span><br><span class="line"><span class="keyword">import</span> com.haven.model.Article;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.JdbcTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Transactional;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> HavenTong</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019/10/30 10:56 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ArticleRestJDBCServiceImpl</span> <span class="keyword">implements</span> <span class="title">ArticleRestService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    ArticleJDBCDAO articleJDBCDAO;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    JdbcTemplate primaryJdbcTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    JdbcTemplate secondaryJdbcTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Article <span class="title">saveArticle</span><span class="params">(Article article)</span> </span>&#123;</span><br><span class="line">        articleJDBCDAO.save(article, primaryJdbcTemplate);</span><br><span class="line">        articleJDBCDAO.save(article, secondaryJdbcTemplate);</span><br><span class="line">        <span class="keyword">return</span> article;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteArticle</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        articleJDBCDAO.deleteById(id, primaryJdbcTemplate);</span><br><span class="line">        articleJDBCDAO.deleteById(id, secondaryJdbcTemplate);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateArticle</span><span class="params">(Article article)</span> </span>&#123;</span><br><span class="line">        articleJDBCDAO.updateById(article, primaryJdbcTemplate);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Article <span class="title">getArticle</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> articleJDBCDAO.findById(id, primaryJdbcTemplate);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Article&gt; <span class="title">getAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> articleJDBCDAO.findAll(primaryJdbcTemplate);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2><span id="3-spring-jdbc-jta实现分布式事务">3. Spring JDBC JTA实现分布式事务</span></h2>
<p><code>@Transactional</code>无法跨库完成分布式事务</p>
<h3><span id="通过整合jta实现分布式事务">通过整合JTA实现分布式事务</span></h3>
<ul>
<li>引入maven依赖</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-jta-atomikos --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jta-atomikos<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.0.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>修改application.yml配置文件</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">primarydb:</span></span><br><span class="line"><span class="attr">  uniqueResourceName:</span> <span class="string">primary</span></span><br><span class="line"><span class="attr">  xaDataSourceClassName:</span> <span class="string">com.mysql.jdbc.jdbc2.optional.MysqlXADataSource</span></span><br><span class="line"><span class="attr">  xaProperties:</span></span><br><span class="line"><span class="attr">    url:</span> <span class="attr">jdbc:mysql://localhost:3306/jdbc</span></span><br><span class="line"><span class="attr">    user:</span> <span class="string">root</span></span><br><span class="line"><span class="attr">    password:</span> <span class="string">Thwf1858</span></span><br><span class="line"><span class="attr">  exclusiveConnectionMode:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">  minPoolSize:</span> <span class="number">3</span></span><br><span class="line"><span class="attr">  maxPoolSize:</span> <span class="number">10</span></span><br><span class="line"><span class="attr">  testQuery:</span> <span class="string">SELECT</span> <span class="number">1</span> <span class="string">FROM</span> <span class="string">dual</span></span><br><span class="line"><span class="attr">secondarydb:</span></span><br><span class="line"><span class="attr">  uniqueResourceName:</span> <span class="string">secondary</span></span><br><span class="line"><span class="attr">  xaDataSourceClassName:</span> <span class="string">com.mysql.jdbc.jdbc2.optional.MysqlXADataSource</span></span><br><span class="line"><span class="attr">  xaProperties:</span></span><br><span class="line"><span class="attr">    url:</span> <span class="attr">jdbc:mysql://localhost:3306/test</span></span><br><span class="line"><span class="attr">    user:</span> <span class="string">root</span></span><br><span class="line"><span class="attr">    password:</span> <span class="string">Thwf1858</span></span><br><span class="line"><span class="attr">  exclusiveConnectionMode:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">  minPoolSize:</span> <span class="number">3</span></span><br><span class="line"><span class="attr">  maxPoolSize:</span> <span class="number">10</span></span><br><span class="line"><span class="attr">  testQuery:</span> <span class="string">SELECT</span> <span class="number">1</span> <span class="string">FROM</span> <span class="string">dual</span></span><br></pre></td></tr></table></figure>
<ul>
<li>编写配置类<code>DataSourceConfig.java</code></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.haven.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.atomikos.jdbc.AtomikosDataSourceBean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Qualifier;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.jdbc.DataSourceBuilder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Primary;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.JdbcTemplate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.sql.DataSource;</span><br><span class="line"><span class="keyword">import</span> javax.xml.crypto.Data;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> HavenTong</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019/10/31 12:08 上午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DataSourceConfig</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 多数据源，分布式</span></span><br><span class="line">    <span class="meta">@Bean</span>(initMethod = <span class="string">"init"</span>, destroyMethod = <span class="string">"close"</span>, name = <span class="string">"primaryDataSource"</span>)</span><br><span class="line">    <span class="meta">@Primary</span></span><br><span class="line">    <span class="meta">@ConfigurationProperties</span>(prefix = <span class="string">"primarydb"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> DataSource <span class="title">primaryDataSource</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> AtomikosDataSourceBean();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span>(initMethod = <span class="string">"init"</span>, destroyMethod = <span class="string">"close"</span>, name = <span class="string">"secondaryDataSource"</span>)</span><br><span class="line">    <span class="meta">@ConfigurationProperties</span>(prefix = <span class="string">"secondarydb"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> DataSource <span class="title">secondaryDataSource</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> AtomikosDataSourceBean();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> JdbcTemplate <span class="title">primaryJdbcTemplate</span><span class="params">(@Qualifier(<span class="string">"primaryDataSource"</span>)</span></span></span><br><span class="line"><span class="function">                                            DataSource primaryDataSource)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> JdbcTemplate(primaryDataSource);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> JdbcTemplate <span class="title">secondaryJdbcTemplate</span><span class="params">(@Qualifier(<span class="string">"secondaryDataSource"</span>)</span></span></span><br><span class="line"><span class="function">                                              DataSource secondaryDataSource)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> JdbcTemplate(secondaryDataSource);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>配置事务管理器™ <code>TransactionManagerConfig.java</code></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.haven.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.atomikos.icatch.jta.UserTransactionImp;</span><br><span class="line"><span class="keyword">import</span> com.atomikos.icatch.jta.UserTransactionManager;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.DependsOn;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.PlatformTransactionManager;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.jta.JtaTransactionManager;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.transaction.SystemException;</span><br><span class="line"><span class="keyword">import</span> javax.transaction.TransactionManager;</span><br><span class="line"><span class="keyword">import</span> javax.transaction.UserTransaction;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> HavenTong</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019/10/31 3:57 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TransactionManagerConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> UserTransaction <span class="title">userTransaction</span><span class="params">()</span> <span class="keyword">throws</span> SystemException </span>&#123;</span><br><span class="line">        UserTransactionImp userTransactionImp = <span class="keyword">new</span> UserTransactionImp();</span><br><span class="line">        userTransactionImp.setTransactionTimeout(<span class="number">10000</span>);</span><br><span class="line">        <span class="keyword">return</span> userTransactionImp;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span>(name = <span class="string">"atomikosTransactionManager"</span>, initMethod = <span class="string">"init"</span>, destroyMethod = <span class="string">"close"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> TransactionManager <span class="title">atomikosTransactionManager</span><span class="params">()</span> <span class="keyword">throws</span> Throwable</span>&#123;</span><br><span class="line">        UserTransactionManager userTransactionManager = <span class="keyword">new</span> UserTransactionManager();</span><br><span class="line">        userTransactionManager.setForceShutdown(<span class="keyword">false</span>);</span><br><span class="line">        <span class="keyword">return</span> userTransactionManager;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span>(name = <span class="string">"transactionManager"</span>)</span><br><span class="line">    <span class="meta">@DependsOn</span>(&#123;<span class="string">"userTransaction"</span>, <span class="string">"atomikosTransactionManger"</span>&#125;)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> PlatformTransactionManager <span class="title">transactionManager</span><span class="params">()</span> <span class="keyword">throws</span> Throwable</span>&#123;</span><br><span class="line">        UserTransaction userTransaction = userTransaction();</span><br><span class="line">        JtaTransactionManager manager = <span class="keyword">new</span> JtaTransactionManager(userTransaction, atomikosTransactionManager());</span><br><span class="line">        <span class="keyword">return</span> manager;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-10-29T15:25:15.000Z" title="2019-10-29T15:25:15.000Z">2019-10-29</time><span class="level-item">5 分钟 读完 (大约 738 个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2019/10/29/Spring-Boot-Bean%E8%87%AA%E5%8A%A8%E8%A3%85%E9%85%8D/">Spring Boot Bean自动装配</a></h1><div class="content"><h1><span id="spring-boot-bean自动装配">Spring Boot Bean自动装配</span></h1>
<h2><span id="1-全局配置文件">1. 全局配置文件</span></h2>
<p>修改Spring Boot自动配置的默认值，Spring Boot在底层自动加载</p>
<ul>
<li>
<p>application.yml</p>
</li>
<li>
<p>application.properties</p>
</li>
</ul>
<h2><span id="2-bean自动装配原理">2. Bean自动装配原理</span></h2>
<p>(1) Spring Boot启动时加载主配置类，开启了自动配置功能<code>@EnableAutoConfiguration</code></p>
<p>(2) <code>@EnableAutoConfiguration</code></p>
<p>​	作用： 将类路径下<code>META-INF/spring.factories</code>里面配置的所有<code>EnableAutoConfiguration</code>的值(自动装配类)加入到执行计划中</p>
<p>(3) 每一个自动装配类进行自动配置功能</p>
<h2><span id="3-yaml规则">3. YAML规则</span></h2>
<p>(1) <strong>双引号</strong></p>
<p>​	不会转义特殊字符，特殊字符或作为本身想要表达的意思</p>
<p>​	<code>name: &quot;zhangsan \n lisi&quot;</code> 输出 <code>zhangsan 换行 lisi</code></p>
<p>​	<strong>单引号</strong></p>
<p>​	会转义特殊字符，特殊字符最终只是一个普通的字符串数据，如：</p>
<p>​	<code>name: 'zhangsan \n lisi'</code> 输出 <code>zhangsan \n lisi</code></p>
<p>(2) 支持松散的结构</p>
<p>​	<code>family-name</code> = <code>familyName</code> = <code>family_name</code></p>
<p>(3) 占位符</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">$&#123;random.value&#125;</span></span><br><span class="line"><span class="string">$&#123;random.int&#125;</span></span><br><span class="line"><span class="string">$&#123;random.long&#125;</span></span><br><span class="line"><span class="string">$&#123;random.int(10)&#125;</span></span><br><span class="line"><span class="string">$&#123;random.int[1024,</span> <span class="number">65536</span><span class="string">]&#125;</span></span><br><span class="line"><span class="string">$&#123;xxxx.yyyy:</span> <span class="string">默认值&#125;</span></span><br></pre></td></tr></table></figure>
<h2><span id="4-获取自定义配置">4. 获取自定义配置</span></h2>
<p>(1) <code>@Value(&quot;${}&quot;)</code></p>
<p>​	实现了单个属性的注入</p>
<p>(2) 对于复杂的数据结构，使用<code>@ConfigurationProperties</code>获取配置值</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.haven.model.yaml;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> HavenTong</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019/10/29 5:44 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties</span>(prefix = <span class="string">"family"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Family</span> </span>&#123;</span><br><span class="line"><span class="comment">//    @Value("$&#123;family.family-name&#125;")</span></span><br><span class="line">    <span class="keyword">private</span> String familyName;</span><br><span class="line">    <span class="keyword">private</span> Father father;</span><br><span class="line">    <span class="keyword">private</span> Mother mother;</span><br><span class="line">    <span class="keyword">private</span> Child child;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>(3) 两种注解区别</p>
<table>
<thead>
<tr>
<th style="text-align:center"></th>
<th style="text-align:center">@ConfigurationProperties</th>
<th style="text-align:center">@Value</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">功能</td>
<td style="text-align:center">批量注入属性</td>
<td style="text-align:center">一个个指定</td>
</tr>
<tr>
<td style="text-align:center">松散语法绑定</td>
<td style="text-align:center">支持</td>
<td style="text-align:center">不支持</td>
</tr>
<tr>
<td style="text-align:center">SpEL</td>
<td style="text-align:center">不支持</td>
<td style="text-align:center">支持</td>
</tr>
<tr>
<td style="text-align:center">复杂数据类型嵌套</td>
<td style="text-align:center">支持</td>
<td style="text-align:center">不支持</td>
</tr>
<tr>
<td style="text-align:center">JSR303数据校验</td>
<td style="text-align:center">支持</td>
<td style="text-align:center">不支持</td>
</tr>
</tbody>
</table>
<h2><span id="5-配置文件注入值数据校验">5. 配置文件注入值数据校验</span></h2>
<p>(1) 在需要校验的属性装配类上加<code>@Validated</code>注解</p>
<p>(2) 数据校验注解列表</p>
<p>(3) 若验证失败，会出现<code>BindValidationException</code>异常</p>
<h2><span id="6-profile不同环境下不同配置">6. Profile不同环境下不同配置</span></h2>
<p><strong>优先级：</strong> 外部大于内部，特指大于泛指</p>
<ul>
<li>application.yml 全局配置文件</li>
<li>application-dev.yml 开发环境配置文件</li>
<li>application-test.yml 测试环境配置文件</li>
<li>Application-prod.yml 生产环境配置文件</li>
</ul>
<p>(1) 配置application.yml</p>
<p>设置<code>spring.profiles.active</code>指定使用哪一个配置文件。</p>
<p>优先级以下面的dev/test/prod yml为优先</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">  profiles:</span></span><br><span class="line"><span class="attr">    active:</span> <span class="string">dev</span></span><br></pre></td></tr></table></figure>
<p>(2) 通过命令行启动</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar SpringBoot01HelloWorld-1.0-SNAPSHOT.jar --spring.profiles.active=dev</span><br></pre></td></tr></table></figure>
<p>(3) IDEA设置Program Arguments</p>
<p>​	(a) Edit Configuration --&gt; Environment --&gt; Program Argument</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--spring.profiles.active=dev</span><br></pre></td></tr></table></figure>
<p>​	(b) Edit Configuration --&gt; Environment --&gt; VM options</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-Dspring.profiles.active=dev</span><br></pre></td></tr></table></figure>
<h2><span id="7-项目内部配置文件加载位置">7. 项目内部配置文件加载位置</span></h2>
<p>spring boot会扫描以下位置的application.properties / application.yml文件作为spring boot的默认配置文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-file:./config/</span><br><span class="line">-file:./</span><br><span class="line">-classpath:/config/</span><br><span class="line">-classpath:./</span><br></pre></td></tr></table></figure>
<p>以上优先级从高到低，所有位置的文件都会被加载；高优先级会覆盖低优先级</p>
<h2><span id="8-配置文件敏感字段加密">8. 配置文件敏感字段加密</span></h2>
<p>(1) 与spring boot整合</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/com.github.ulisesbocchio/jasypt-spring-boot-starter --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.ulisesbocchio<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jasypt-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.18<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>(2) 需要加密的地方，使用<code>ENC()</code>进行包裹处理</p>
<p>(3) 在配置文件中设置密钥</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-10-29T08:30:40.000Z" title="2019-10-29T08:30:40.000Z">2019-10-29</time><span class="level-item">8 分钟 读完 (大约 1193 个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2019/10/29/SpringBoot-RESTful%E6%8E%A5%E5%8F%A3/">SpringBoot RESTful接口</a></h1><div class="content"><h1><span id="springboot-restful接口">SpringBoot RESTful接口</span></h1>
<h2><span id="1常用注解开发restful接口">1.常用注解开发RESTful接口</span></h2>
<ul>
<li>
<p><code>@RestController</code></p>
<ol>
<li>将注解的类注入到Spring的环境</li>
<li>相当于<code>@Controller</code> + <code>@ResponseBody</code></li>
<li>JSON格式的数据响应</li>
</ol>
</li>
<li>
<p><code>@RequestMapping</code></p>
<ol>
<li>类上的注解表示注解的Controller类的路径</li>
</ol>
</li>
<li>
<p><code>@PathVariable</code></p>
<ol>
<li>路径上的变量</li>
</ol>
</li>
<li>
<p><code>@PathVariable</code> &amp; <code>RequestParam</code></p>
<ol>
<li><code>@PathVariable</code>用于接收URL上的{参数}</li>
<li><code>@RequestParam</code>用于接收普通方式提供的参数</li>
</ol>
</li>
<li>
<p><code>@RequestBody</code> &amp; <code>@RequestParam</code></p>
<ol>
<li>
<p>JSON数据建议用<code>@RequestBody</code>,会分配实体类中的所有属性</p>
</li>
<li>
<p><code>@RequestParam</code>适合接收单个的参数</p>
</li>
<li>
<p><code>@RequestBody</code>可以接收嵌套的数据结构</p>
</li>
</ol>
</li>
</ul>
<h2><span id="2json数据处理和postman测试">2.JSON数据处理和Postman测试</span></h2>
<p><strong>Spring Boot默认使用Jackson</strong></p>
<h4><span id="1-常用注解">(1) 常用注解</span></h4>
<ul>
<li>
<p><code>@JsonIgnore</code>：加在属性上表示在序列化和反序列化的过程中将它忽略</p>
</li>
<li>
<p><code>@JsonProperty</code>：为属性起别名</p>
</li>
<li>
<p><code>@JsonPropertyOrder</code>：加在类上</p>
</li>
<li>
<p><code>@JsonInclude(JsonInclude.Include.NON_NULL)</code>: 当属性不为空的时候，进行序列化；否则不进行</p>
</li>
<li>
<p><code>@JsonFormat(pattern = &quot;&quot;, timezone = &quot;&quot;)</code>：配置时间格式</p>
  <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">	<span class="attr">jackson:</span></span><br><span class="line">		<span class="attr">date-format:</span> <span class="string">yyyy-MM-dd</span> <span class="attr">HH:mm:ss</span></span><br><span class="line">		<span class="attr">time-zone:</span> <span class="string">GMT+8</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4><span id="2-序列化与反序列化">(2) 序列化与反序列化</span></h4>
<p>把对象转成可传输、可存储的格式(json, xml, 二进制，甚至自定义的格式)叫序列化，反序列化为逆过程</p>
<h2><span id="3-postman使用">3. Postman使用</span></h2>
<h2><span id="4-使用swagger-2发布api文档">4. 使用Swagger 2发布API文档</span></h2>
<ul>
<li>代码变，文档变，只需要少量的注解，使用Swagger就可以根据代码自动生成API文档，很好地保持了文档的及时性</li>
<li>跨语言性，支持40多种语言</li>
<li>Swagge UI呈现出一份可交互式的API文档，我们可以直接在文档页面尝试API的调用，省去了准备复杂的</li>
</ul>
<p>调用参数的过程</p>
<ul>
<li>还可以将文档规范导入相关的工具(e.x. SoapUI)，这些工具会为我们创建自动化的测试</li>
</ul>
<h3><span id="整合swagger-2">整合Swagger 2</span></h3>
<p>pom.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger-ui<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// config/Swagger2.java</span></span><br><span class="line"><span class="keyword">package</span> com.haven.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Configurable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.w3c.dom.DocumentType;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.builders.ApiInfoBuilder;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.builders.PathSelectors;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.builders.RequestHandlerSelectors;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.service.ApiInfo;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.spi.DocumentationType;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.spring.web.plugins.Docket;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.swagger2.annotations.EnableSwagger2;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> HavenTong</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019/10/29 3:26 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableSwagger</span>2</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Swagger2</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Docket <span class="title">createRestApi</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Docket(DocumentationType.SWAGGER_2)</span><br><span class="line">                .apiInfo(apiInfo())</span><br><span class="line">                .select()</span><br><span class="line">                .apis(RequestHandlerSelectors.basePackage(<span class="string">"com.haven"</span>))</span><br><span class="line">                .paths(PathSelectors.regex(<span class="string">"/rest/.*"</span>))</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> ApiInfo <span class="title">apiInfo</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ApiInfoBuilder()</span><br><span class="line">                .title(<span class="string">"springboot利用swagger构建api文档"</span>)</span><br><span class="line">                .description(<span class="string">"简单优雅的restfun风格"</span>)</span><br><span class="line">                .termsOfServiceUrl(<span class="string">"http://www.zimug.com"</span>)</span><br><span class="line">                .version(<span class="string">"1.0"</span>)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>之后启动项目，通过<code>http://localhost:8080/swagger-ui.html</code>即可访问swagger-ui</p>
<p>可以在方法上添加更详细的注解：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">    <span class="meta">@ApiOperation</span>(value = <span class="string">"添加文章"</span>, notes = <span class="string">"添加新的文章"</span>, tags = <span class="string">"Article"</span>, httpMethod = <span class="string">"POST"</span>)</span><br><span class="line"><span class="comment">//    @ApiImplicitParams(&#123;</span></span><br><span class="line"><span class="comment">//            @ApiImplicitParam(name = "title", value = "文章标题", required = true, dataType = "String"),</span></span><br><span class="line"><span class="comment">//            @ApiImplicitParam(name = "content", value = "文章内容", required = true, dataType = "String"),</span></span><br><span class="line"><span class="comment">//            @ApiImplicitParam(name = "author", value = "文章作者", required = true, dataType = "String")</span></span><br><span class="line"><span class="comment">//    &#125;)</span></span><br><span class="line">    <span class="meta">@ApiResponses</span>(&#123;</span><br><span class="line">            <span class="meta">@ApiResponse</span>(code = <span class="number">200</span>, message = <span class="string">"成功"</span>, response = AjaxResponse.class),</span><br><span class="line">            <span class="meta">@ApiResponse</span>(code = <span class="number">400</span>, message = <span class="string">"用户输入错误"</span>, response = AjaxResponse.class),</span><br><span class="line">            <span class="meta">@ApiResponse</span>(code = <span class="number">500</span>, message = <span class="string">"系统内部错误"</span>, response = AjaxResponse.class)</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="meta">@RequestMapping</span>(value = <span class="string">"/article"</span>, method = RequestMethod.POST, produces = <span class="string">"application/json"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> AjaxResponse <span class="title">saveArticle</span><span class="params">(@RequestBody Article article)</span></span>&#123;</span><br></pre></td></tr></table></figure>
<ul>
<li>由于采用<code>@RequestBody</code>去接收参数，这里就不需要使用<code>@ApiImplicitParam</code>注解，<code>@ApiImplicitParam</code>注解与<code>@RequestParam</code>注解是一一对应的。</li>
<li>建议有Swagger 2的情况下，减少与此对应的代码注释或不写</li>
</ul>
<h3><span id="swagger-2常用注解">Swagger 2常用注解</span></h3>
<ul>
<li>
<p><code>@Api</code>：用在请求的类上，表示对类的说明</p>
<p>​	<code>tags=</code>“说明该类的作用，可以在UI界面上看到的注解”</p>
<p>​	<code>value=</code>“该参数没有什么意义，在UI界面上也能看到，所以不需要配置”</p>
</li>
<li>
<p><code>@ApiOperation</code>: 用在请求的方法上，说明方法的用途、作用</p>
<p>​	<code>value=</code>“说明方法的用途，作用”</p>
<p>​	<code>notes=</code>“方法的备注说明”</p>
</li>
<li>
<p><code>@ApiImplicitParams</code>: 用在请求的方法上，表示一组参数说明</p>
<p>​	<code>@ApiImplicitParam</code>: 用在<code>@ApiImplicitParams</code>注解中，指定一个请求参数的各个方面</p>
<p>​		<code>name=</code>“参数名”</p>
<p>​		<code>value=</code>“参数的汉字说明，解释”</p>
<p>​		<code>required=</code>“参数是否必须要传”</p>
<p>​		<code>paramType=</code>“参数放在哪个地方”</p>
<p>​			- <code>header</code> --&gt; 请求参数的获取：<code>@RequestHeader</code></p>
<p>​			- <code>query</code> --&gt; 请求参数的获取：<code>@RequestParam</code></p>
<p>​			- <code>path</code>(用于restful接口) --&gt; 请求参数的获取: <code>@PathVariable</code></p>
<p>​			- <code>body</code>,<code>form</code>不常用</p>
<p>​		<code>dataType=</code> “参数类型”，默认String, 其他值<code>dataType=&quot;Integer&quot;</code></p>
<p>​		<code>defaultValue=</code> “参数的默认值”</p>
</li>
<li>
<p><code>@ApiResponses</code>: 用在请求的方法上，表示一组响应</p>
<p>​	<code>@ApiResponse</code>: 用在<code>@ApiResponses</code>中，一般用于表达一个错误的响应信息</p>
<p>​		<code>code=</code> 数字，e.x. 400</p>
<p>​		<code>message=</code> 信息，例如&quot;请求参数没填好&quot;</p>
<p>​		<code>response=</code> 抛出异常的类</p>
</li>
<li>
<p><code>@ApiModel</code>: 用于响应类上，表示一个返回响应数据的信息。(这种一般用在post创建的时候, 使用<code>@RequestBody</code>的场景，请求参数无法使用<code>@ApiImplicitParam</code>注解进行描述的时候)</p>
<p>​	<code>@ApiModelProperty</code>: 用在属性上，描述响应类的属性</p>
<p>​</p>
<p>​</p>
</li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-10-26T07:20:10.000Z" title="2019-10-26T07:20:10.000Z">2019-10-26</time><span class="level-item">1 分钟 读完 (大约 122 个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2019/10/26/Spring-Boot-IDEA%E5%BC%80%E5%8F%91%E6%8A%80%E5%B7%A7/">Spring Boot-IDEA开发技巧</a></h1><div class="content"><h1><span id="springboot-with-idea">SpringBoot with IDEA</span></h1>
<h2><span id="插件">插件</span></h2>
<p><strong>lombok</strong></p>
<ul>
<li>
<p>IDEA中下载后</p>
</li>
<li>
<p>在pom.xml文件中引入依赖</p>
  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>常用注解</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Builder</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><strong>GsonFormat</strong></p>
<ul>
<li>可以快速的将JSON转换为实体类</li>
<li><em>shortcut</em> <code>option + s</code></li>
</ul>
<h2><span id="热部署">热部署</span></h2>
<ul>
<li>
<p>pom文件中引入依赖</p>
  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>pom文件中引入依赖</p>
  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">fork</span>&gt;</span>true<span class="tag">&lt;/<span class="name">fork</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>Preferences – Compiler – Build project automatically ✅</p>
</li>
<li>
<p><code>cmd + option + shift + /</code> – registry – <strong>compiler.automake.allow.when.app.running</strong> – ✅</p>
</li>
<li>
<p>配置完成后，修改项目文件后会自动build</p>
</li>
</ul>
</div></article></div><nav class="pagination is-centered mt-4" role="navigation" aria-label="pagination"><div class="pagination-previous"><a href="/">上一页</a></div><div class="pagination-next"><a href="/archives/3/">下一页</a></div><ul class="pagination-list is-hidden-mobile"><li><a class="pagination-link" href="/">1</a></li><li><a class="pagination-link is-current" href="/archives/2/">2</a></li><li><a class="pagination-link" href="/archives/3/">3</a></li></ul></nav></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1"><div class="card widget"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="is-rounded" src="/img/tom_avatar.png" alt="Haven Tong"></figure><p class="title is-size-4 is-block line-height-inherit">Haven Tong</p><p class="is-size-6 is-block">Senior</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>East China Normal University, Shanghai</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">26</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">0</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">13</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/HavenTong" target="_blank" rel="noopener">关注我</a></div><div class="level is-mobile"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/HavenTong"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Email" href="mailto:hanwen.tong@outlook.com"><i class="fas fa-envelope"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com/Haven51320644"><i class="fab fa-twitter"></i></a></div></div></div><!--!--><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">归档</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/archives/2020/06/"><span class="level-start"><span class="level-item">六月 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/05/"><span class="level-start"><span class="level-item">五月 2020</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/03/"><span class="level-start"><span class="level-item">三月 2020</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/02/"><span class="level-start"><span class="level-item">二月 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/12/"><span class="level-start"><span class="level-item">十二月 2019</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/11/"><span class="level-start"><span class="level-item">十一月 2019</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/10/"><span class="level-start"><span class="level-item">十月 2019</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/09/"><span class="level-start"><span class="level-item">九月 2019</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/07/"><span class="level-start"><span class="level-item">七月 2019</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2017/03/"><span class="level-start"><span class="level-item">三月 2017</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div><div class="column-right-shadow is-hidden-widescreen"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3"><!--!--><div class="card widget"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><a class="media-left" href="/2020/06/27/Happy-Birthday/"><p class="image is-64x64"><img class="thumbnail" src="/gallery/thumbnails/candies.jpg" alt="Happy Birthday"></p></a><div class="media-content size-small"><p><time dateTime="2020-06-26T16:13:24.000Z">2020-06-27</time></p><p class="title is-6"><a class="link-muted" href="/2020/06/27/Happy-Birthday/">Happy Birthday</a></p><p class="is-uppercase"></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2020-05-21T09:54:59.000Z">2020-05-21</time></p><p class="title is-6"><a class="link-muted" href="/2020/05/21/New-Theme/">New Theme</a></p><p class="is-uppercase"></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2020-05-16T15:29:50.000Z">2020-05-16</time></p><p class="title is-6"><a class="link-muted" href="/2020/05/16/FIRST-AK/">FIRST AK</a></p><p class="is-uppercase"></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2020-03-06T04:38:45.000Z">2020-03-06</time></p><p class="title is-6"><a class="link-muted" href="/2020/03/06/Topological-Sort/">Topological-Sort</a></p><p class="is-uppercase"></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2020-03-05T10:25:30.000Z">2020-03-05</time></p><p class="title is-6"><a class="link-muted" href="/2020/03/05/Java-Map/">Java-Map</a></p><p class="is-uppercase"></p></div></article></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">标签</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/Algorithm/"><span class="tag">Algorithm</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Blog/"><span class="tag">Blog</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/C/"><span class="tag">C++</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Hexo/"><span class="tag">Hexo</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Java/"><span class="tag">Java</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Life/"><span class="tag">Life</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Moment/"><span class="tag">Moment</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/MongoDB/"><span class="tag">MongoDB</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/STL/"><span class="tag">STL</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Spring-Boot/"><span class="tag">Spring Boot</span><span class="tag is-grey-lightest">10</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Vue/"><span class="tag">Vue</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/redis/"><span class="tag">redis</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"><span class="tag">机器学习</span><span class="tag is-grey-lightest">1</span></a></div></div></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/">HavenTong&#039;s Memory Palace</a><p class="size-small"><span>&copy; 2021 Haven Tong</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a><br><span id="busuanzi_container_site_uv">共<span id="busuanzi_value_site_uv">0</span>个访客</span></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            site: {
                url: 'http://yoursite.com',
                external_link: {"enable":true,"exclude":[]}
            },
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css"><script src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/mhchem.js" defer></script><script>window.addEventListener("load", function() {
            document.querySelectorAll('[role="article"] > .content').forEach(function(element) {
                renderMathInElement(element);
            });
        });</script><script type="text/x-mathjax-config">MathJax.Hub.Config({
            'HTML-CSS': {
                matchFontHeight: false
            },
            SVG: {
                matchFontHeight: false
            },
            CommonHTML: {
                matchFontHeight: false
            },
            tex2jax: {
                inlineMath: [
                    ['$','$'],
                    ['\\(','\\)']
                ]
            }
        });</script><script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>